#ifndef ADAPT_UTILITY_MATH_H
#define ADAPT_UTILITY_MATH_H

#include <cmath>
#include <array>

namespace adapt
{

namespace detail
{

inline constexpr std::pair<double, double> cl_68_intervals[] =
{
 { 0, 1.841022 },
 { 0.172754,	3.299527 },
 { 0.708185,	4.63786 },
 { 1.367295,	5.918186 },
 { 2.085661,	7.162753 },
 { 2.840309,	8.382473 },
 { 3.620069,	9.583642 },
 { 4.41853,	10.770281 },
 { 5.231614,	11.945142 },
 { 6.056539,	13.110204 },
 { 6.891306,	14.26695 },
 { 7.734421,	15.416521 },
 { 8.584734,	16.559819 },
 { 9.441338,	17.697573 },
 { 10.3035,	18.830381 },
 { 11.17062,	19.958739 },
 { 12.042199,	21.083066 },
 { 12.917816,	22.203719 },
 { 13.797113,	23.321007 },
 { 14.679781,	24.435196 },
 { 15.565552,	25.546519 },
 { 16.454193,	26.655182 },
 { 17.345497,	27.761366 },
 { 18.239283,	28.865235 },
 { 19.135388,	29.966932 },
 { 20.033665,	31.066589 },
 { 20.933985,	32.164324 },
 { 21.836229,	33.260244 },
 { 22.740289,	34.354446 },
 { 23.646069,	35.44702 },
 { 24.553478,	36.538047 },
 { 25.462435,	37.627601 },
 { 26.372865,	38.715754 },
 { 27.284698,	39.802567 },
 { 28.197871,	40.888101 },
 { 29.112325,	41.97241 },
 { 30.028004,	43.055545 },
 { 30.944857,	44.137555 },
 { 31.862837,	45.218484 },
 { 32.781898,	46.298372 },
 { 33.702,	47.377261 },
 { 34.623102,	48.455185 },
 { 35.545169,	49.53218 },
 { 36.468166,	50.608278 },
 { 37.39206,	51.68351 },
 { 38.316821,	52.757904 },
 { 39.242419,	53.831489 },
 { 40.168828,	54.904289 },
 { 41.096021,	55.97633 },
 { 42.023974,	57.047634 },
 { 42.952663,	58.118225 },
 { 43.882067,	59.188122 },
 { 44.812164,	60.257346 },
 { 45.742935,	61.325916 },
 { 46.67436,	62.39385 },
 { 47.606421,	63.461166 },
 { 48.5391,	64.52788 },
 { 49.472381,	65.594007 },
 { 50.406249,	66.659564 },
 { 51.340688,	67.724565 },
 { 52.275683,	68.789023 },
 { 53.211221,	69.852952 },
 { 54.147288,	70.916366 },
 { 55.08387,	71.979274 },
 { 56.020958,	73.041692 },
 { 56.958537,	74.103628 },
 { 57.896598,	75.165095 },
 { 58.835128,	76.226102 },
 { 59.774117,	77.28666 },
 { 60.713556,	78.346779 },
 { 61.653434,	79.406468 },
 { 62.593742,	80.465736 },
 { 63.534471,	81.524592 },
 { 64.475612,	82.583044 },
 { 65.417156,	83.641101 },
 { 66.359097,	84.698771 },
 { 67.301425,	85.756061 },
 { 68.244132,	86.812979 },
 { 69.187212,	87.869531 },
 { 70.130657,	88.925725 },
 { 71.074461,	89.981567 },
 { 72.018616,	91.037065 },
 { 72.963117,	92.092223 },
 { 73.907955,	93.14705 },
 { 74.853128,	94.201549 },
 { 75.798626,	95.255728 },
 { 76.744445,	96.309591 },
 { 77.69058,	97.363144 },
 { 78.637024,	98.416393 },
 { 79.583774,	99.469342 },
 { 80.530823,	100.521997 },
 { 81.478166,	101.574363 },
 { 82.425799,	102.626443 },
 { 83.373716,	103.678243 },
 { 84.321914,	104.729768 },
 { 85.270388,	105.781022 },
 { 86.219133,	106.832007 },
 { 87.168146,	107.882731 },
 { 88.117421,	108.933195 },
 { 89.066956,	109.983403 }
};

inline constexpr std::pair<double, double> cl_95_intervals[] =
{
 { 0, 3.68888 },
 { 0.025318,	5.571643 },
 { 0.242209,	7.224687 },
 { 0.618672,	8.767273 },
 { 1.089865,	10.241589 },
 { 1.623486,	11.668332 },
 { 2.201894,	13.059474 },
 { 2.814363,	14.422676 },
 { 3.453832,	15.763189 },
 { 4.115373, 17.084804 },
 { 4.795389,	18.390357 },
 { 5.491161,	19.682038 },
 { 6.200575,	20.961584 },
 { 6.921953,	22.230396 },
 { 7.65393,	23.489621 },
 { 8.395386,	24.74022 },
 { 9.145383,	25.982997 },
 { 9.903127,	27.218647 },
 { 10.667941,	28.447761 },
 { 11.439241,	29.670853 },
 { 12.216519,	30.888378 },
 { 12.999331,	32.100732 },
 { 13.787283,	33.308264 },
 { 14.580027,	34.511293 },
 { 15.377253,	35.710098 },
 { 16.178682,	36.904932 },
 { 16.984063,	38.096024 },
 { 17.79317,	39.283582 },
 { 18.605796,	40.467796 },
 { 19.421755,	41.648837 },
 { 20.240874,	42.826867 },
 { 21.062995,	44.002025 },
 { 21.887976,	45.174452 },
 { 22.715682,	46.344268 },
 { 23.545989,	47.511592 },
 { 24.378783,	48.676528 },
 { 25.213958,	49.839174 },
 { 26.051414,	50.999625 },
 { 26.891061,	52.15797 },
 { 27.732813,	53.314285 },
 { 28.576586,	54.468648 },
 { 29.422308,	55.621128 },
 { 30.269906,	56.771799 },
 { 31.119313,	57.920718 },
 { 31.970468,	59.067946 },
 { 32.823309,	60.213542 },
 { 33.677782,	61.357554 },
 { 34.533831,	62.500036 },
 { 35.391412,	63.641035 },
 { 36.25047,	64.7806 },
 { 37.110963,	65.918768 },
 { 37.972849,	67.055583 },
 { 38.836088,	68.191082 },
 { 39.700637,	69.325306 },
 { 40.566462,	70.458286 },
 { 41.433527,	71.590061 },
 { 42.301798,	72.720659 },
 { 43.171243,	73.850112 },
 { 44.041832,	74.97845 },
 { 44.913533,	76.1057 },
 { 45.78632,	77.231894 },
 { 46.660167,	78.357052 },
 { 47.535045,	79.481201 },
 { 48.41093,	80.604367 },
 { 49.287798,	81.726571 },
 { 50.165627,	82.847837 },
 { 51.044395,	83.968184 },
 { 51.92408,	85.087631 },
 { 52.80466,	86.206205 },
 { 53.686119,	87.323916 },
 { 54.568434,	88.44079 },
 { 55.45159,	89.55684 },
 { 56.335565,	90.672083 },
 { 57.220346,	91.78654 },
 { 58.105916,	92.900224 },
 { 58.992257,	94.01315 },
 { 59.879356,	95.125334 },
 { 60.767196,	96.236788 },
 { 61.655763,	97.34753 },
 { 62.545044,	98.457572 },
 { 63.435025,	99.566926 },
 { 64.325691,	100.675605 },
 { 65.217035,	101.78362 },
 { 66.109037,	102.890988 },
 { 67.00169,	103.997715 },
 { 67.89498,	105.103815 },
 { 68.788898,	106.2093 },
 { 69.683432,	107.314177 },
 { 70.578574,	108.418461 },
 { 71.474308,	109.522158 },
 { 72.370629,	110.62528 },
 { 73.267525,	111.727834 },
 { 74.164985,	112.829835 },
 { 75.063002,	113.931282 },
 { 75.961569,	115.032194 },
 { 76.860672,	116.132575 },
 { 77.760309,	117.232432 },
 { 78.660466,	118.331775 },
 { 79.561138,	119.43061 },
 { 80.462316,	120.528948 }
};

}

inline std::pair<double, double> GetPoissonCI68(uint64_t count)
{
	if (count < 100)
		return detail::cl_68_intervals[count];
	else
	{
		double e = std::sqrt((double)count);
		return { count - e, count + e };
	}
}
inline std::pair<double, double> GetPoissonCI95(uint64_t count)
{
	if (count < 100)
		return detail::cl_95_intervals[count];
	else
	{
		double e = std::sqrt((double)count) * 2;
		return { count - e, count + e };
	}
}

}

#endif